import streamlit as st
import numpy as np
import matplotlib.pyplot as plt
from matplotlib import cm
import io

# 1. –ù–ê–õ–ê–®–¢–£–í–ê–ù–ù–Ø –°–¢–û–†–Ü–ù–ö–ò
st.set_page_config(page_title="–ú–∞–Ω–¥–∞–ª–∞ –æ—Å–æ–±–∏—Å—Ç–æ—Å—Ç—ñ", layout="wide")

st.title("üé® –¶–∏—Ñ—Ä–æ–≤–∞ –º–∞–Ω–¥–∞–ª–∞ –æ—Å–æ–±–∏—Å—Ç–æ—Å—Ç—ñ")
st.write("### –ú–∞—Ç–µ–º–∞—Ç–∏—á–Ω–æ-–º–∏—Å—Ç–µ—Ü—å–∫–∏–π –ø—Ä–æ—î–∫—Ç. –í—ñ–∑—É–∞–ª—ñ–∑–∞—Ü—ñ—è –±—ñ–æ–º–µ—Ç—Ä–∏—á–Ω–∏—Ö –¥–∞–Ω–∏—Ö")
st.markdown("---")

# 2. –í–ö–õ–ê–î–ö–ò
tab1, tab2 = st.tabs(["üöÄ –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –º–∞–Ω–¥–∞–ª–∏", "üìú –ù–∞—É–∫–æ–≤–µ –æ–±“ë—Ä—É–Ω—Ç—É–≤–∞–Ω–Ω—è"])

with tab2:
    st.header("–ú–∞—Ç–µ–º–∞—Ç–∏—á–Ω–∞ –¥–µ–∫–æ–º–ø–æ–∑–∏—Ü—ñ—è –º–æ–¥–µ–ª—ñ")
    st.write("""
    –ü—Ä–æ—î–∫—Ç –±–∞–∑—É—î—Ç—å—Å—è –Ω–∞ –ø–æ–±—É–¥–æ–≤—ñ –±–∞–≥–∞—Ç–æ—à–∞—Ä–æ–≤–æ—ó –≥—Ä–∞—Ñ—ñ—á–Ω–æ—ó —Å–∏—Å—Ç–µ–º–∏ –≤ –ø–æ–ª—è—Ä–Ω–∏—Ö –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞—Ö $(r, \\theta)$. 
    –ö–æ–∂–µ–Ω —à–∞—Ä —î –≥—Ä–∞—Ñ—ñ–∫–æ–º —Ñ—É–Ω–∫—Ü—ñ—ó, –ø–∞—Ä–∞–º–µ—Ç—Ä–∏ —è–∫–æ—ó –≤–∏–∑–Ω–∞—á–∞—é—Ç—å—Å—è –≤—Ö—ñ–¥–Ω–∏–º–∏ –¥–∞–Ω–∏–º–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞.
    """)

    # --- 1. –ì–õ–û–ë–ê–õ–¨–ù–ò–ô –ü–†–û–°–¢–Ü–† ---
    st.subheader("1. –ì–ª–æ–±–∞–ª—å–Ω–µ –º–∞—Å—à—Ç–∞–±—É–≤–∞–Ω–Ω—è")
    st.write("–î–ª—è –∑–∞–±–µ–∑–ø–µ—á–µ–Ω–Ω—è –∫–æ–º–ø–æ–∑–∏—Ü—ñ–π–Ω–æ—ó —Ü—ñ–ª—ñ—Å–Ω–æ—Å—Ç—ñ –ø—Ä–æ—Å—Ç—ñ—Ä –Ω–æ—Ä–º–æ–≤–∞–Ω–æ. –í—Å—ñ –æ–±'—î–∫—Ç–∏ –≤–ø–∏—Å–∞–Ω—ñ –≤ –æ–¥–∏–Ω–∏—á–Ω–µ –∫–æ–ª–æ:")
    st.latex(r"R_{max} \approx 1.5 \cdot \text{Unit}")
    st.write("–¶–µ –¥–æ–∑–≤–æ–ª—è—î –ø–æ—Ä—ñ–≤–Ω—é–≤–∞—Ç–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—É –æ—Å–æ–±–∏—Å—Ç–æ—Å—Ç–µ–π –±–µ–∑ –≤—ñ–∑—É–∞–ª—å–Ω–æ–≥–æ —Å–ø–æ—Ç–≤–æ—Ä–µ–Ω–Ω—è –º–∞—Å—à—Ç–∞–±—É.")

    # --- 2. –°–û–ù ---
    st.subheader("2. –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–µ —è–¥—Ä–æ (–†–µ—Å—É—Ä—Å)")
    st.write("–ö—ñ–ª—å—Ü–µ —Å–∏–º–≤–æ–ª—ñ–∑—É—î –µ–Ω–µ—Ä–≥–µ—Ç–∏—á–Ω–∏–π —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç. –†–∞–¥—ñ—É—Å –≤–Ω—É—Ç—Ä—ñ—à–Ω—å–æ–≥–æ –æ—Ç–≤–æ—Ä—É ($r_{hole}$) –æ–±–µ—Ä–Ω–µ–Ω–æ –ø—Ä–æ–ø–æ—Ä—Ü—ñ–π–Ω–∏–π –∫—ñ–ª—å–∫–æ—Å—Ç—ñ —Å–Ω—É ($S$):")
    st.latex(r"r_{hole} = R_{core} \cdot \left(1 - \frac{S}{12}\right)")
    st.write("–ü—Ä–∏ $S=12$ (–º–∞–∫—Å–∏–º—É–º) –æ—Ç–≤—ñ—Ä –∑–Ω–∏–∫–∞—î, —É—Ç–≤–æ—Ä—é—é—á–∏ —Å—É—Ü—ñ–ª—å–Ω–∏–π –¥–∏—Å–∫. –ü—Ä–∏ –¥–µ—Ñ—ñ—Ü–∏—Ç—ñ —Å–Ω—É —è–¥—Ä–æ —Å—Ç–∞—î –ø–æ—Ä–æ–∂–Ω—ñ–º –∫—ñ–ª—å—Ü–µ–º.")

    # --- 3. –î–ï–ù–¨ –ù–ê–†–û–î–ñ–ï–ù–ù–Ø ---
    st.subheader("3. –ì–∞—Ä–º–æ–Ω—ñ—á–Ω–∏–π —Ä–µ–∑–æ–Ω–∞–Ω—Å (–î–µ–Ω—å –Ω–∞—Ä–æ–¥–∂–µ–Ω–Ω—è)")
    st.write("–î—Ä—É–≥–∏–π —à–∞—Ä ‚Äî —Ü–µ –≥–∞—Ä–º–æ–Ω—ñ—á–Ω–∞ –∑—ñ—Ä–∫–∞. –î–µ–Ω—å –Ω–∞—Ä–æ–¥–∂–µ–Ω–Ω—è ($d$) –≤–∏–∑–Ω–∞—á–∞—î **—á–∞—Å—Ç–æ—Ç—É** –∫–æ–ª–∏–≤–∞–Ω—å (–∫—ñ–ª—å–∫—ñ—Å—Ç—å –≤–µ—Ä—à–∏–Ω):")
    st.latex(r"r(\theta) = R_{base} + A \cdot \cos(d \cdot \theta)")
    st.write("–¢–∞–∫–∏–º —á–∏–Ω–æ–º, —á–∏—Å–ª–æ –≤–µ—Ä—à–∏–Ω –º–∞—Ç–µ–º–∞—Ç–∏—á–Ω–æ —Ç–æ—Ç–æ–∂–Ω–µ –¥–∞—Ç—ñ –Ω–∞—Ä–æ–¥–∂–µ–Ω–Ω—è.")

    # --- 4. –ü–ï–õ–Æ–°–¢–ö–ò ---
    st.subheader("4. –ï–º–æ—Ü—ñ–π–Ω–∏–π –∫–æ–Ω—Ç—É—Ä (–ú—ñ—Å—è—Ü—å —Ç–∞ –í–ø–µ–≤–Ω–µ–Ω—ñ—Å—Ç—å)")
    st.write("–§–æ—Ä–º–∞ –ø–µ–ª—é—Å—Ç–æ–∫ –≤–∏–∑–Ω–∞—á–∞—î—Ç—å—Å—è –º—ñ—Å—è—Ü–µ–º ($n$), –∞ —ó—Ö–Ω—è –≥–µ–æ–º–µ—Ç—Ä—ñ—è –º–æ–¥—É–ª—é—î—Ç—å—Å—è –í–ø–µ–≤–Ω–µ–Ω—ñ—Å—Ç—é ($E$):")
    st.latex(r"r_{rose} = |\cos(\frac{n}{2}\theta)|^p")
    st.write("–ü–æ–∫–∞–∑–Ω–∏–∫ —Å—Ç–µ–ø–µ–Ω—è $p$ –∑–∞–ª–µ–∂–∏—Ç—å –≤—ñ–¥ $E$. –í–∏—Å–æ–∫–∞ –≤–ø–µ–≤–Ω–µ–Ω—ñ—Å—Ç—å –ø–µ—Ä–µ—Ç–≤–æ—Ä—é—î –ø–ª–∞–≤–Ω—ñ –ª—ñ–Ω—ñ—ó –Ω–∞ –≥–æ—Å—Ç—Ä—ñ –≤–µ–∫—Ç–æ—Ä–∏.")

    # --- 5. –ï–ù–ï–†–ì–Ü–Ø –¢–ê –î–û–°–í–Ü–î ---
    st.subheader("5. –ü–æ–ª–µ –∂–∏—Ç—Ç—î–≤–æ–≥–æ –¥–æ—Å–≤—ñ–¥—É (–°–ø—ñ—Ä–∞–ª—å –§–µ—Ä–º–∞)")
    st.write("–î–ª—è –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –≤—ñ–∫—É –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–æ –º–æ–¥–µ–ª—å **—Ñ—ñ–ª–æ—Ç–∞–∫—Å–∏—Å—É** (–∑–æ–ª–æ—Ç–∏–π –ø–µ—Ä–µ—Ç–∏–Ω). –¶–µ –¥–æ–∑–≤–æ–ª—è—î —Ä–æ–∑–º—ñ—Å—Ç–∏—Ç–∏ –≤–µ–ª–∏–∫—É –∫—ñ–ª—å–∫—ñ—Å—Ç—å —Ç–æ—á–æ–∫ –±–µ–∑ —Ö–∞–æ—Å—É.")
    st.latex(r"r_n = c \sqrt{n}, \quad \theta_n = n \times 137.5^\circ")
    st.write("**–ü–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–∞—Ü—ñ—è:**")
    st.write("""
    * **–í—ñ–∫ ($A$):** –í–∏–∑–Ω–∞—á–∞—î —Ç–æ—á–Ω—É –∫—ñ–ª—å–∫—ñ—Å—Ç—å —Ç–æ—á–æ–∫-–ø–æ–¥—ñ–π.
    * **–ï–Ω–µ—Ä–≥—ñ—è ($T$):** –í–∏–∑–Ω–∞—á–∞—î –¥–≤–∞ —Ñ–∞–∫—Ç–æ—Ä–∏: 
        1. –©—ñ–ª—å–Ω—ñ—Å—Ç—å –µ–Ω–µ—Ä–≥–µ—Ç–∏—á–Ω–æ—ó —Å—ñ—Ç–∫–∏ (–∫—ñ–ª—å–∫—ñ—Å—Ç—å —Ä–∞–¥—ñ–∞–ª—å–Ω–∏—Ö –ø—Ä–æ–º–µ–Ω—ñ–≤).
        2. –†–æ–∑–º—ñ—Ä —Å–∞–º–∏—Ö —Ç–æ—á–æ–∫ (–º–∞—Å–∞ –ø–æ–¥—ñ—ó).
    """)

    # --- 6. –ó–†–Ü–°–¢ ---
    st.subheader("6. –ó–æ–≤–Ω—ñ—à–Ω—ñ–π –ø–µ—Ä–∏–º–µ—Ç—Ä (–ó—Ä—ñ—Å—Ç)")
    st.write("–ó—Ä—ñ—Å—Ç ($H$) –≤–∏–∑–Ω–∞—á–∞—î —á–∞—Å—Ç–æ—Ç–Ω—É —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫—É –∑–∞—Ö–∏—Å–Ω–æ–≥–æ –±–∞—Ä'—î—Ä–∞ (–∫—ñ–ª—å–∫—ñ—Å—Ç—å –∑—É–±—Ü—ñ–≤ –º–µ–∂—ñ):")
    st.latex(r"N_{peaks} = \frac{H}{10}")
    st.write("–ì–µ–æ–º–µ—Ç—Ä—ñ—è –∑—É–±—Ü—ñ–≤ (–≥–æ—Å—Ç—Ä—ñ —á–∏ –º'—è–∫—ñ) –∑–∞–ª–µ–∂–∏—Ç—å –≤—ñ–¥ –°—Ç–∞—Ç—ñ ($G$).")

    # --- 7. –¢–ï–ú–ü–ï–†–ê–ú–ï–ù–¢ ---
    st.subheader("7. –ì—Ä–∞—Ñ—ñ—á–Ω–∞ —Ñ—ñ–∑–∏–∫–∞ (–¢–µ–º–ø–µ—Ä–∞–º–µ–Ω—Ç)")
    st.write("–¢–µ–º–ø–µ—Ä–∞–º–µ–Ω—Ç –≤–∏–∑–Ω–∞—á–∞—î '–≤–∞–≥—É' —Ç–∞ '–ø—Ä–æ–∑–æ—Ä—ñ—Å—Ç—å' –ª—ñ–Ω—ñ–π:")
    st.write("""
    * **–•–æ–ª–µ—Ä–∏–∫:** –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞ —Ç–æ–≤—â–∏–Ω–∞ (`lw`), –ø–æ–≤–Ω–∞ –Ω–µ–ø—Ä–æ–∑–æ—Ä—ñ—Å—Ç—å (`alpha=1.0`).
    * **–°–∞–Ω–≥–≤—ñ–Ω—ñ–∫:** –°–µ—Ä–µ–¥–Ω—è —Ç–æ–≤—â–∏–Ω–∞, –≤–∏—Å–æ–∫–∞ –ø—Ä–æ–∑–æ—Ä—ñ—Å—Ç—å.
    * **–§–ª–µ–≥–º–∞—Ç–∏–∫:** –ú–∞—Å–∏–≤–Ω—ñ –ª—ñ–Ω—ñ—ó, –∞–ª–µ –∑–Ω–∞—á–Ω–∞ –ø—Ä–æ–∑–æ—Ä—ñ—Å—Ç—å (–µ—Ñ–µ–∫—Ç –æ–±'—î–º—É).
    * **–ú–µ–ª–∞–Ω—Ö–æ–ª—ñ–∫:** –¢–æ–Ω–∫—ñ, –¥–µ–ª—ñ–∫–∞—Ç–Ω—ñ –ª—ñ–Ω—ñ—ó.
    """)

with tab1:
    # –ü–ê–ù–ï–õ–¨ –ö–ï–†–£–í–ê–ù–ù–Ø
    st.sidebar.header("üìã –¢–≤–æ—ó –¥–∞–Ω—ñ")
    with st.sidebar:
        # –ì—Ä—É–ø–∞ 1: –ë–∞–∑–æ–≤—ñ –¥–∞–Ω—ñ
        n = st.number_input("–ú—ñ—Å—è—Ü—å –Ω–∞—Ä–æ–¥–∂–µ–Ω–Ω—è", 1, 12, 6)
        d = st.number_input("–î–µ–Ω—å –Ω–∞—Ä–æ–¥–∂–µ–Ω–Ω—è", 1, 31, 15)
        
        H = st.slider("–ó—Ä—ñ—Å—Ç (—Å–º)", 100, 220, 170, help="–í–∏–∑–Ω–∞—á–∞—î –∫—ñ–ª—å–∫—ñ—Å—Ç—å –∑—É–±—Ü—ñ–≤ –Ω–∞ –º–µ–∂—ñ")
        A = st.slider("–í—ñ–∫", 10, 100, 45, help="–ö—ñ–ª—å–∫—ñ—Å—Ç—å —Ç–æ—á–æ–∫ —É —Å–ø—ñ—Ä–∞–ª—ñ")
        S = st.slider("–ì–æ–¥–∏–Ω —Å–Ω—É", 0, 12, 8, help="–í–∏–∑–Ω–∞—á–∞—î —â—ñ–ª—å–Ω—ñ—Å—Ç—å —Ü–µ–Ω—Ç—Ä—É")
        
        st.markdown("---")
        # –ì—Ä—É–ø–∞ 2: –ü—Å–∏—Ö–æ–ª–æ–≥—ñ—è
        E = st.slider("–í–ø–µ–≤–Ω–µ–Ω—ñ—Å—Ç—å", 0, 10, 5, help="–ì–æ—Å—Ç—Ä–æ—Ç–∞ –ø–µ–ª—é—Å—Ç–æ–∫")
        T = st.slider("–ï–Ω–µ—Ä–≥—ñ—è", 1, 10, 5, help="–ö—ñ–ª—å–∫—ñ—Å—Ç—å –ø—Ä–æ–º–µ–Ω—ñ–≤ —Ç–∞ —Ä–æ–∑–º—ñ—Ä —Ç–æ—á–æ–∫!")
        
        st.markdown("---")
        # –ì—Ä—É–ø–∞ 3: –°—Ç–∏–ª—å
        G = st.radio("–°—Ç–∞—Ç—å", options=[1, -1], format_func=lambda x: "–ß–æ–ª–æ–≤—ñ—á–∞" if x == 1 else "–ñ—ñ–Ω–æ—á–∞")
        temp = st.selectbox("–¢–µ–º–ø–µ—Ä–∞–º–µ–Ω—Ç", options=["–°–∞–Ω–≥–≤—ñ–Ω—ñ–∫", "–•–æ–ª–µ—Ä–∏–∫", "–§–ª–µ–≥–º–∞—Ç–∏–∫", "–ú–µ–ª–∞–Ω—Ö–æ–ª—ñ–∫"])
        eye_choice = st.selectbox("–ö–æ–ª—ñ—Ä –æ—á–µ–π", options=[1, 2, 3, 4], 
                                  format_func=lambda x: {1:"–ë–ª–∞–∫–∏—Ç–Ω—ñ", 2:"–ó–µ–ª–µ–Ω—ñ", 3:"–ö–∞—Ä—ñ", 4:"–Ø–Ω—Ç–∞—Ä–Ω—ñ"}[x])

    # –ì–ï–ù–ï–†–ê–¶–Ü–Ø
    def generate_mandala():
        # –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è —Å—Ç–∏–ª—ñ–≤
        style_map = {
            "–°–∞–Ω–≥–≤—ñ–Ω—ñ–∫": {"lw": 2.0, "alpha": 0.8},
            "–•–æ–ª–µ—Ä–∏–∫":   {"lw": 4.5, "alpha": 1.0}, # –ù–∞—Å–∏—á–µ–Ω–∏–π
            "–§–ª–µ–≥–º–∞—Ç–∏–∫": {"lw": 5.0, "alpha": 0.3}, # –®–∏—Ä–æ–∫–∏–π —ñ –ø—Ä–æ–∑–æ—Ä–∏–π
            "–ú–µ–ª–∞–Ω—Ö–æ–ª—ñ–∫": {"lw": 1.0, "alpha": 0.7} # –¢–æ–Ω–∫–∏–π
        }
        s = style_map[temp]
        selected_cmap = {1: cm.winter, 2: cm.summer, 3: cm.autumn, 4: cm.spring}.get(eye_choice, cm.plasma)
        
        t = np.linspace(0, 2 * np.pi, 5000)
        fig = plt.figure(figsize=(8, 8), facecolor='black')
        ax = plt.subplot(111, projection='polar')
        ax.set_facecolor('black')
        
        SCALE = 0.12 
        
        # === 1. –Ø–î–†–û (–°–û–ù S) ===
        R_core = 2.0 * SCALE
        r_hole = R_core * max(0.0, 1 - (S / 12.0))
        
        ax.fill_between(t, r_hole, R_core, color=selected_cmap(0.9), alpha=s["alpha"])
        ax.plot(t, np.full_like(t, r_hole), color='white', linewidth=s["lw"]*0.3, alpha=0.5)

        # === 2. –ó–Ü–†–ö–ê (–î–ï–ù–¨ –ù–ê–†–û–î–ñ–ï–ù–ù–Ø d) ===
        R_layer2 = R_core + 0.3 * SCALE
        r_star = R_layer2 + 0.25 * SCALE * np.cos(d * t)
        ax.plot(t, r_star, color=selected_cmap(0.7), linewidth=s["lw"], alpha=s["alpha"])

        # === 3. –ü–ï–õ–Æ–°–¢–ö–ò (–ú–Ü–°–Ø–¶–¨ n) ===
        R_rose_base = R_layer2 + 0.5 * SCALE
        e_val = (11 - E) / 2
        r_rose = R_rose_base + (np.abs(np.cos(n/2 * t)))**e_val * 2.5 * SCALE
        
        ax.fill(t, r_rose, color=selected_cmap(0.3), alpha=0.3)
        ax.plot(t, r_rose, color=selected_cmap(0.4), linewidth=s["lw"], alpha=s["alpha"])

        # === 4. –ù–ê–°–ò–ß–ï–ù–ê –°–Ü–¢–ö–ê (–ï–ù–ï–†–ì–Ü–Ø T) ===
        max_r_rose = r_rose.max()
        r_grid_end = max_r_rose + 4.0 * SCALE 
        
        # –†–∞–¥—ñ–∞–ª—å–Ω—ñ –ø—Ä–æ–º–µ–Ω—ñ
        num_rays = int(T * 4) + 4
        for i in range(num_rays):
            angle = (2 * np.pi / num_rays) * i
            ax.plot([angle, angle], [max_r_rose, r_grid_end], 
                    color=selected_cmap(0.6), 
                    linewidth=s["lw"] * 0.6, 
                    alpha=s["alpha"] * 0.7,  
                    linestyle="-")

        # –ü–æ–ø–µ—Ä–µ—á–Ω—ñ –∫—ñ–ª—å—Ü—è
        r_ticks = np.arange(max_r_rose, r_grid_end, 0.6 * SCALE)
        for r_tick in r_ticks:
            ax.plot(t, np.full_like(t, r_tick), 
                    color=selected_cmap(0.5), 
                    linewidth=s["lw"] * 0.4, 
                    alpha=s["alpha"] * 0.5)

        # === 5. –°–ü–Ü–†–ê–õ–Ü –§–ï–†–ú–ê (–í–Ü–ö A) ===
        golden_angle = 2.39996323 
        spacing = 0.08 * SCALE 
        
        points_theta = []
        points_r = []
        colors = []
        sizes = []

        for i in range(1, A + 1):
            theta = i * golden_angle * G
            r = max_r_rose + spacing * np.sqrt(i) * 3.5
            
            points_theta.append(theta)
            points_r.append(r)
            colors.append(selected_cmap(i / A))
            
            # –†–æ–∑–º—ñ—Ä —Ç–æ—á–æ–∫ –∑–∞–ª–µ–∂–∏—Ç—å –≤—ñ–¥ –ï–Ω–µ—Ä–≥—ñ—ó —Ç–∞ –¢–µ–º–ø–µ—Ä–∞–º–µ–Ω—Ç—É
            base_size = 30 + (T * 8) 
            sizes.append(base_size * (s["lw"] * 0.8)) 

        ax.scatter(points_theta, points_r, c=colors, s=sizes, 
                   alpha=s["alpha"], cmap=selected_cmap, edgecolors='none')

        # === 6. –ú–ï–ñ–ê (–ó–†–Ü–°–¢ H) ===
        border_freq = int(H / 10)
        
        max_dist = max(points_r) if points_r else r_grid_end
        r_border_base = max(r_grid_end, max_dist + 0.5 * SCALE)
        
        p_shape = 0.5 if G == 1 else 1.5
        crown = (np.abs(np.sin(border_freq * t)))**p_shape
        r_border = r_border_base + (0.8 * SCALE * crown)
        
        ax.plot(t, r_border, color=selected_cmap(0.9), 
                linewidth=s["lw"] * 1.5,
                alpha=s["alpha"])

        # –§—ñ–∫—Å–∞—Ü—ñ—è
        ax.set_ylim(0, r_border_base * 1.15)
        ax.set_axis_off()
        return fig

    col1, col2 = st.columns([1, 2])
    with col2:
        fig = generate_mandala()
        st.pyplot(fig)
        
        buf = io.BytesIO()
        fig.savefig(buf, format="png", facecolor='black', dpi=300)
        st.download_button("üì• –ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ PNG", buf.getvalue(), "mandala.png", "image/png")
