import time

# ... (–≤–∞—à –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ–π –∫–æ–¥ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω—å —Ç–∞ —Å–ª–∞–π–¥–µ—Ä—ñ–≤) ...

# –ó–ú–Ü–ù–ê 1: –î–æ–¥–∞—î–º–æ –∞—Ä–≥—É–º–µ–Ω—Ç 'phase' (—Ñ–∞–∑–∞ —á–∞—Å—É) —É —Ñ—É–Ω–∫—Ü—ñ—é
def generate_mandala(phase=0):
    # –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è —Å—Ç–∏–ª—ñ–≤ (–±–µ–∑ –∑–º—ñ–Ω)
    style_map = {
        "–°–∞–Ω–≥–≤—ñ–Ω—ñ–∫": {"lw": 2.0, "alpha": 0.8},
        "–•–æ–ª–µ—Ä–∏–∫":   {"lw": 4.5, "alpha": 1.0},
        "–§–ª–µ–≥–º–∞—Ç–∏–∫": {"lw": 5.0, "alpha": 0.3},
        "–ú–µ–ª–∞–Ω—Ö–æ–ª—ñ–∫": {"lw": 1.0, "alpha": 0.7}
    }
    s = style_map[temp]
    selected_cmap = {1: cm.winter, 2: cm.summer, 3: cm.autumn, 4: cm.spring}.get(eye_choice, cm.plasma)
    
    t = np.linspace(0, 2 * np.pi, 5000)
    fig = plt.figure(figsize=(8, 8), facecolor='black')
    ax = plt.subplot(111, projection='polar')
    ax.set_facecolor('black')
    
    SCALE = 0.12 
    
    # === –î–ò–ù–ê–ú–Ü–ß–ù–ò–ô –ö–û–ï–§–Ü–¶–Ü–Ñ–ù–¢ ===
    # –¶–µ –∑–º—É—Å–∏—Ç—å –º–∞–Ω–¥–∞–ª—É "–¥–∏—Ö–∞—Ç–∏". phase –∑–º—ñ–Ω—é—î—Ç—å—Å—è –≤—ñ–¥ 0 –¥–æ –Ω–µ—Å–∫—ñ–Ω—á–µ–Ω–Ω–æ—Å—Ç—ñ
    # breath –∑–º—ñ–Ω—é—î—Ç—å—Å—è –≤—ñ–¥ 0.95 –¥–æ 1.05
    breath = 1.0 + 0.05 * np.sin(phase) 
    
    # === 1. –Ø–î–†–û (–°–û–ù S) ===
    R_core = 2.0 * SCALE * breath # <--- –î–æ–¥–∞–ª–∏ –ø—É–ª—å—Å–∞—Ü—ñ—é
    r_hole = R_core * max(0.0, 1 - (S / 12.0))
    
    ax.fill_between(t, r_hole, R_core, color=selected_cmap(0.9), alpha=s["alpha"])
    ax.plot(t, np.full_like(t, r_hole), color='white', linewidth=s["lw"]*0.3, alpha=0.5)

    # === 2. –ó–Ü–†–ö–ê (–î–ï–ù–¨ –ù–ê–†–û–î–ñ–ï–ù–ù–Ø d) ===
    R_layer2 = R_core + 0.3 * SCALE
    # –î–æ–¥–∞–º–æ –µ—Ñ–µ–∫—Ç –æ–±–µ—Ä—Ç–∞–Ω–Ω—è –¥–ª—è –∑—ñ—Ä–∫–∏ (+ phase/10 –¥–æ –∫—É—Ç–∞ t)
    r_star = R_layer2 + 0.25 * SCALE * np.cos(d * (t + phase/20)) 
    ax.plot(t, r_star, color=selected_cmap(0.7), linewidth=s["lw"], alpha=s["alpha"])

    # === 3. –ü–ï–õ–Æ–°–¢–ö–ò (–ú–Ü–°–Ø–¶–¨ n) ===
    R_rose_base = R_layer2 + 0.5 * SCALE
    e_val = (11 - E) / 2
    r_rose = R_rose_base + (np.abs(np.cos(n/2 * t)))**e_val * 2.5 * SCALE
    
    ax.fill(t, r_rose, color=selected_cmap(0.3), alpha=0.3)
    ax.plot(t, r_rose, color=selected_cmap(0.4), linewidth=s["lw"], alpha=s["alpha"])

    # ... (–†–µ—à—Ç–∞ –∫–æ–¥—É –±–µ–∑ –∑–º—ñ–Ω, –∞–±–æ —Ç–µ–∂ –¥–æ–¥–∞–π—Ç–µ * breath –¥–æ —Ä–∞–¥—ñ—É—Å—ñ–≤) ...
    # –î–ª—è —Å–∫–æ—Ä–æ—á–µ–Ω–Ω—è —è –∑–∞–ª–∏—à—É –ª–∏—à–µ –æ—Å–Ω–æ–≤–Ω—ñ –∑–º—ñ–Ω–∏, –∞–ª–µ –ø—Ä–∏–Ω—Ü–∏–ø —Ç–æ–π —Å–∞–º–∏–π:
    # –î–µ —Ö–æ—á–µ—Ç–µ —Ä—É—Ö - –º–Ω–æ–∂—Ç–µ —Ä–∞–¥—ñ—É—Å –Ω–∞ breath –∞–±–æ –¥–æ–¥–∞–≤–∞–π—Ç–µ phase –¥–æ –∫—É—Ç–∞ t.
    
    # ... (–ö–æ–¥ 4, 5, 6 —Ä–æ–∑–¥—ñ–ª—ñ–≤ –∑ –≤–∞—à–æ–≥–æ –æ—Ä–∏–≥—ñ–Ω–∞–ª—É –≤—Å—Ç–∞–≤–ª—è—î—Ç—å—Å—è —Ç—É—Ç) ...
    
    # –ü–æ–≤–µ—Ä—Ç–∞—î–º–æ —Ñ—ñ–∫—Å–∞—Ü—ñ—é, —â–æ–± –≥—Ä–∞—Ñ—ñ–∫ –Ω–µ —Å–∫–∞–∫–∞–≤ –ø—Ä–∏ –∑–º—ñ–Ω—ñ —Ä–æ–∑–º—ñ—Ä—É
    ax.set_ylim(0, 2.5) # –í–∞–∂–ª–∏–≤–æ –∑–∞—Ñ—ñ–∫—Å—É–≤–∞—Ç–∏ –º–∞—Å—à—Ç–∞–±!
    ax.set_axis_off()
    return fig

# –í–Ü–î–û–ë–†–ê–ñ–ï–ù–ù–Ø
col1, col2 = st.columns([1, 2])

with col1:
    st.write("### –ö–µ—Ä—É–≤–∞–Ω–Ω—è")
    run_anim = st.checkbox("üåÄ –£–≤—ñ–º–∫–Ω—É—Ç–∏ '–î–∏—Ö–∞–Ω–Ω—è'")
    st.info("–ê–Ω—ñ–º–∞—Ü—ñ—è –º–æ–∂–µ —Ç—Ä–æ—Ö–∏ –Ω–∞–≤–∞–Ω—Ç–∞–∂—É–≤–∞—Ç–∏ –ø—Ä–æ—Ü–µ—Å–æ—Ä.")

with col2:
    placeholder = st.empty() # –°—Ç–≤–æ—Ä—é—î–º–æ –ø—É—Å—Ç–µ –º—ñ—Å—Ü–µ –¥–ª—è –≥—Ä–∞—Ñ—ñ–∫–∞
    
    if run_anim:
        # –¶–∏–∫–ª –∞–Ω—ñ–º–∞—Ü—ñ—ó
        for i in range(100): # 100 –∫–∞–¥—Ä—ñ–≤, –ø–æ—Ç—ñ–º –∑—É–ø–∏–Ω–∏—Ç—å—Å—è (—â–æ–± –Ω–µ –∑–∞–≤–∏—Å –±—Ä–∞—É–∑–µ—Ä)
            fig = generate_mandala(phase=i * 0.5)
            placeholder.pyplot(fig)
            plt.close(fig) # –í–∞–∂–ª–∏–≤–æ –∑–∞–∫—Ä–∏–≤–∞—Ç–∏ —Ñ—ñ–≥—É—Ä—É, —â–æ–± –Ω–µ –∑–∞–±–∏—Ç–∏ –ø–∞–º'—è—Ç—å
            time.sleep(0.1) # –®–≤–∏–¥–∫—ñ—Å—Ç—å –æ–Ω–æ–≤–ª–µ–Ω–Ω—è
    else:
        # –°—Ç–∞—Ç–∏—á–Ω–∏–π –≤–∏–≥–ª—è–¥
        fig = generate_mandala(phase=0)
        placeholder.pyplot(fig)
