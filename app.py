import streamlit as st
import numpy as np
import matplotlib.pyplot as plt
from matplotlib import cm
import io

# 1. –ù–ê–õ–ê–®–¢–£–í–ê–ù–ù–Ø –°–¢–û–†–Ü–ù–ö–ò
st.set_page_config(page_title="–ú–∞–Ω–¥–∞–ª–∞ –æ—Å–æ–±–∏—Å—Ç–æ—Å—Ç—ñ", layout="wide")

st.title("üé® –¶–∏—Ñ—Ä–æ–≤–∞ –º–∞–Ω–¥–∞–ª–∞ –æ—Å–æ–±–∏—Å—Ç–æ—Å—Ç—ñ")
st.write("### –ú–∞—Ç–µ–º–∞—Ç–∏—á–Ω–æ-–º–∏—Å—Ç–µ—Ü—å–∫–∏–π –ø—Ä–æ—î–∫—Ç. –í—ñ–∑—É–∞–ª—ñ–∑–∞—Ü—ñ—è –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–∏—Ö –¥–∞–Ω–∏—Ö")
st.markdown("---")

# 2. –í–ö–õ–ê–î–ö–ò
tab1, tab2 = st.tabs(["üöÄ –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –º–∞–Ω–¥–∞–ª–∏", "üìú –ù–∞—É–∫–æ–≤–µ –æ–±“ë—Ä—É–Ω—Ç—É–≤–∞–Ω–Ω—è"])

with tab2:
    st.header("–ú–∞—Ç–µ–º–∞—Ç–∏—á–Ω–∞ –¥–µ–∫–æ–º–ø–æ–∑–∏—Ü—ñ—è –º–æ–¥–µ–ª—ñ")
    st.write("""
    –ü—Ä–æ—î–∫—Ç –±–∞–∑—É—î—Ç—å—Å—è –Ω–∞ –ø–æ–±—É–¥–æ–≤—ñ –±–∞–≥–∞—Ç–æ—à–∞—Ä–æ–≤–æ—ó –≥—Ä–∞—Ñ—ñ—á–Ω–æ—ó —Å–∏—Å—Ç–µ–º–∏ –≤ –ø–æ–ª—è—Ä–Ω–∏—Ö –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞—Ö $(r, \\theta)$. 
    –ü—Ä–æ—Å—Ç—ñ—Ä –Ω–æ—Ä–º–æ–≤–∞–Ω–æ –¥–æ –æ–¥–∏–Ω–∏—á–Ω–æ–≥–æ –∫–æ–ª–∞ $R_{max} \\approx 1.0$, —â–æ –∑–∞–±–µ–∑–ø–µ—á—É—î –∫–æ–º–ø–æ–∑–∏—Ü—ñ–π–Ω—É —Ä—ñ–≤–Ω—ñ—Å—Ç—å —É—Å—ñ—Ö –æ–±'—î–∫—Ç—ñ–≤.
    """)

    # --- –ó–†–Ü–°–¢ (–ù–æ–≤–µ) ---
    st.subheader("1. –§–æ–Ω–æ–≤–∞ —ñ–Ω—Ç–µ—Ä—Ñ–µ—Ä–µ–Ω—Ü—ñ—è (–ó—Ä—ñ—Å—Ç)")
    st.write("–ó—Ä—ñ—Å—Ç ($H$) –±—ñ–ª—å—à–µ –Ω–µ –≤–ø–ª–∏–≤–∞—î –Ω–∞ —Ä–æ–∑–º—ñ—Ä –º–∞–Ω–¥–∞–ª–∏, –∞ –≤–∏–∑–Ω–∞—á–∞—î **—á–∞—Å—Ç–æ—Ç—É –≥–∞—Ä–º–æ–Ω—ñ—á–Ω–∏—Ö –∫–æ–ª–∏–≤–∞–Ω—å** —Ñ–æ–Ω–æ–≤–æ–≥–æ —à–∞—Ä—É. –¶–µ —Å—Ç–≤–æ—Ä—é—î –µ—Ñ–µ–∫—Ç –Ω–∞—Å–∏—á–µ–Ω–æ—Å—Ç—ñ –ø—Ä–æ—Å—Ç–æ—Ä—É.")
    st.latex(r"r_{bg}(\theta) = 0.5 + 0.5 \cdot \sin(k \cdot \theta), \quad \text{–¥–µ } k = \frac{H}{10}")
    st.write("–ß–∏–º –≤–∏—â–∏–π –∑—Ä—ñ—Å—Ç, —Ç–∏–º –≤–∏—â–∏–π –∫–æ–µ—Ñ—ñ—Ü—ñ—î–Ω—Ç $k$, —â–æ –ø—Ä–∏–∑–≤–æ–¥–∏—Ç—å –¥–æ –≥—É—Å—Ç—ñ—à–æ—ó —Å—ñ—Ç–∫–∏ –ª—ñ–Ω—ñ–π (–≤–∏—Å–æ–∫–æ—á–∞—Å—Ç–æ—Ç–Ω–∏–π –≤—ñ–∑–µ—Ä—É–Ω–æ–∫).")

    # --- –°–û–ù (–ù–æ–≤–µ) ---
    st.subheader("2. –¢–æ–ø–æ–ª–æ–≥—ñ—è –Ø–¥—Ä–∞ (–°–æ–Ω)")
    st.write("–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∏–π –µ–ª–µ–º–µ–Ω—Ç ‚Äî —Ü–µ –∫—ñ–ª—å—Ü–µ –∑ —Ñ—ñ–∫—Å–æ–≤–∞–Ω–∏–º –∑–æ–≤–Ω—ñ—à–Ω—ñ–º —Ä–∞–¥—ñ—É—Å–æ–º $R_{core} = 0.25$. –ü–æ–∫–∞–∑–Ω–∏–∫ —Å–Ω—É ($S$) –≤–∏–∑–Ω–∞—á–∞—î —Ä–∞–¥—ñ—É—Å –≤–Ω—É—Ç—Ä—ñ—à–Ω—å–æ–≥–æ –æ—Ç–≤–æ—Ä—É ($r_{hole}$):")
    st.latex(r"r_{hole} = R_{core} \cdot \left( 1 - \frac{S}{S_{max}} \right)")
    st.write("""
    * –Ø–∫—â–æ $S \to S_{max}$ (–º–∞–∫—Å–∏–º–∞–ª—å–Ω–∏–π —Å–æ–Ω), —Ç–æ $r_{hole} \to 0$ (—Å—É—Ü—ñ–ª—å–Ω–µ –∫–æ–ª–æ, –ø–æ–≤–Ω–∏–π —Ä–µ—Å—É—Ä—Å).
    * –Ø–∫—â–æ $S \to 0$ (–º—ñ–Ω—ñ–º–∞–ª—å–Ω–∏–π —Å–æ–Ω), —Ç–æ $r_{hole} \to R_{core}$ (—Ç–æ–Ω–∫–µ –∫—ñ–ª—å—Ü–µ, –≤–∏—Å–Ω–∞–∂–µ–Ω–Ω—è).
    """)

    # --- –ü–ï–õ–Æ–°–¢–ö–ò ---
    st.subheader("3. –®–∞—Ä –ø–µ–ª—é—Å—Ç–æ–∫ (–ú—ñ—Å—è—Ü—å —Ç–∞ –í–ø–µ–≤–Ω–µ–Ω—ñ—Å—Ç—å)")
    st.write("–í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è —Ä—ñ–≤–Ω—è–Ω–Ω—è –ø–æ–ª—è—Ä–Ω–æ—ó —Ç—Ä–æ—è–Ω–¥–∏ –∑ –º–æ–¥—É–ª—è—Ü—ñ—î—é –≥–æ—Å—Ç—Ä–æ—Ç–∏:")
    st.latex(r"r_{petal}(\theta) = R_{core} + A \cdot |\cos(\frac{n}{2}\theta)|^p")
    st.write("–ü–æ–∫–∞–∑–Ω–∏–∫ —Å—Ç–µ–ø–µ–Ω—è $p$ –∑–∞–ª–µ–∂–∏—Ç—å –≤—ñ–¥ –≤–ø–µ–≤–Ω–µ–Ω–æ—Å—Ç—ñ ($E$). –í–∏—Å–æ–∫–µ $E$ —Ä–æ–±–∏—Ç—å –ø–µ–ª—é—Å—Ç–∫–∏ –≥–æ—Å—Ç—Ä–∏–º–∏ ($p < 1$), –Ω–∏–∑—å–∫–µ ‚Äî –æ–∫—Ä—É–≥–ª–∏–º–∏ ($p > 1$).")

    # --- –°–ü–Ü–†–ê–õ–Ü ---
    st.subheader("4. –ü–æ–ª–µ —Å–ø—ñ—Ä–∞–ª–µ–π (–í—ñ–∫)")
    st.write("–í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è —Å—ñ–º'—è **–ê—Ä—Ö—ñ–º–µ–¥–æ–≤–∏—Ö —Å–ø—ñ—Ä–∞–ª–µ–π**. –ö—ñ–ª—å–∫—ñ—Å—Ç—å –ª—ñ–Ω—ñ–π –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î –≤—ñ–∫—É ($A$). –†—ñ–≤–Ω—è–Ω–Ω—è –æ–¥–Ω—ñ—î—ó –ª—ñ–Ω—ñ—ó:")
    st.latex(r"r = a + b \cdot (\theta + \phi_i)")
    st.write("–î–µ —Ñ–∞–∑–æ–≤–∏–π –∑—Å—É–≤ $\phi_i$ —Ç–∞ –Ω–∞–ø—Ä—è–º–æ–∫ –∑–∞–∫—Ä—É—á—É–≤–∞–Ω–Ω—è –∑–∞–ª–µ–∂–∞—Ç—å –≤—ñ–¥ –ï–Ω–µ—Ä–≥—ñ—ó ($T$) —Ç–∞ –°—Ç–∞—Ç—ñ ($G$).")

    # --- –¢–ï–ú–ü–ï–†–ê–ú–ï–ù–¢ ---
    st.subheader("5. –°—Ç–∏–ª—ñ–∑–∞—Ü—ñ—è –ª—ñ–Ω—ñ–π (–¢–µ–º–ø–µ—Ä–∞–º–µ–Ω—Ç)")
    st.write("–ú–∞—Ç–µ–º–∞—Ç–∏—á–Ω—ñ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏ –≤—ñ–∑—É–∞–ª—ñ–∑–∞—Ü—ñ—ó (—Ç–æ–≤—â–∏–Ω–∞ –ª—ñ–Ω—ñ–π, –ø—Ä–æ–∑–æ—Ä—ñ—Å—Ç—å, –ø—É–Ω–∫—Ç–∏—Ä) –∞–¥–∞–ø—Ç—É—é—Ç—å—Å—è –ø—ñ–¥ –ø—Å–∏—Ö–æ—Ç–∏–ø –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞.")

with tab1:
    # –ü–ê–ù–ï–õ–¨ –ö–ï–†–£–í–ê–ù–ù–Ø
    st.sidebar.header("üìã –¢–≤–æ—ó –¥–∞–Ω—ñ")
    with st.sidebar:
        n = st.number_input("–ú—ñ—Å—è—Ü—å –Ω–∞—Ä–æ–¥–∂–µ–Ω–Ω—è", 1, 12, 6)
        d = st.number_input("–î–µ–Ω—å –Ω–∞—Ä–æ–¥–∂–µ–Ω–Ω—è", 1, 31, 15)
        
        # –ó—Ä—ñ—Å—Ç —Ç–µ–ø–µ—Ä "–ù–∞—Å–∏—á–µ–Ω—ñ—Å—Ç—å"
        H = st.slider("–ó—Ä—ñ—Å—Ç (—Å–º)", 100, 220, 170, help="–í–ø–ª–∏–≤–∞—î –Ω–∞ –≥—É—Å—Ç–æ—Ç—É —Ñ–æ–Ω–æ–≤–∏—Ö –ª—ñ–Ω—ñ–π.")
        A = st.slider("–í—ñ–∫", 10, 100, 45)
        
        # –°–æ–Ω - –¥–æ 12 –≥–æ–¥–∏–Ω –¥–æ—Å—Ç–∞—Ç–Ω—å–æ –¥–ª—è –Ω–æ—Ä–º–∏
        S = st.slider("–ì–æ–¥–∏–Ω —Å–Ω—É", 0, 12, 8, help="–ú–∞–∫—Å–∏–º—É–º —Ä–æ–±–∏—Ç—å –∫–æ–ª–æ —Å—É—Ü—ñ–ª—å–Ω–∏–º.")
        
        st.markdown("---")
        E = st.slider("–í–ø–µ–≤–Ω–µ–Ω—ñ—Å—Ç—å", 0, 10, 5, help="–ó–º—ñ–Ω—é—î –ì–û–°–¢–†–û–¢–£ –ø–µ–ª—é—Å—Ç–æ–∫.")
        T = st.slider("–ï–Ω–µ—Ä–≥—ñ—è", 0, 10, 5, help="–ó–º—ñ–Ω—é—î –ó–ê–ö–†–£–ß–ï–ù–Ü–°–¢–¨ —Å–ø—ñ—Ä–∞–ª—ñ.")
        
        st.markdown("---")
        G = st.radio("–°—Ç–∞—Ç—å", options=[1, -1], format_func=lambda x: "–ß–æ–ª–æ–≤—ñ—á–∞" if x == 1 else "–ñ—ñ–Ω–æ—á–∞")
        temp = st.selectbox("–¢–µ–º–ø–µ—Ä–∞–º–µ–Ω—Ç", options=["–°–∞–Ω–≥–≤—ñ–Ω—ñ–∫", "–•–æ–ª–µ—Ä–∏–∫", "–§–ª–µ–≥–º–∞—Ç–∏–∫", "–ú–µ–ª–∞–Ω—Ö–æ–ª—ñ–∫"])
        eye_choice = st.selectbox("–ö–æ–ª—ñ—Ä –æ—á–µ–π", options=[1, 2, 3, 4], 
                                  format_func=lambda x: {1:"–ë–ª–∞–∫–∏—Ç–Ω—ñ", 2:"–ó–µ–ª–µ–Ω—ñ", 3:"–ö–∞—Ä—ñ", 4:"–Ø–Ω—Ç–∞—Ä–Ω—ñ"}[x])

    # –ì–†–ê–§–Ü–ß–ù–ê –õ–û–ì–Ü–ö–ê
    def generate_mandala():
        style_map = {
            "–°–∞–Ω–≥–≤—ñ–Ω—ñ–∫": {"lw": 2.0, "alpha": 0.8, "ls": "-", "f_alpha": 0.4},
            "–•–æ–ª–µ—Ä–∏–∫":   {"lw": 4.0, "alpha": 1.0, "ls": "-", "f_alpha": 0.6},
            "–§–ª–µ–≥–º–∞—Ç–∏–∫": {"lw": 6.0, "alpha": 0.4, "ls": "-", "f_alpha": 0.2},
            "–ú–µ–ª–∞–Ω—Ö–æ–ª—ñ–∫": {"lw": 0.8, "alpha": 0.8, "ls": "--", "f_alpha": 0.2}
        }
        s = style_map[temp]
        
        color_maps = {1: cm.winter, 2: cm.summer, 3: cm.autumn, 4: cm.spring}
        selected_cmap = color_maps.get(eye_choice, cm.plasma)
        
        # –ó–±—ñ–ª—å—à—É—î–º–æ —Ä–æ–∑–¥—ñ–ª—å–Ω—É –∑–¥–∞—Ç–Ω—ñ—Å—Ç—å –¥–ª—è –ø–ª–∞–≤–Ω–æ—Å—Ç—ñ
        t = np.linspace(0, 12 * np.pi, 3000)
        
        fig = plt.figure(figsize=(6, 6), facecolor='black')
        ax = plt.subplot(111, projection='polar')
        ax.set_facecolor('black')
        
        # === 1. –®–ê–† –ó–†–û–°–¢–£ (–ù–ê–°–ò–ß–ï–ù–Ü–°–¢–¨ / –§–û–ù) ===
        # –ó–∞–º—ñ—Å—Ç—å –∑–º—ñ–Ω–∏ —Ä–æ–∑–º—ñ—Ä—É, –∑—Ä—ñ—Å—Ç —Å—Ç–≤–æ—Ä—é—î —Ñ–æ–Ω–æ–≤—É —Å—Ç—Ä—É–∫—Ç—É—Ä—É (–Ü–Ω—Ç–µ—Ä—Ñ–µ—Ä–µ–Ω—Ü—ñ—è)
        # –í–∏—Å–æ–∫–∞ –ª—é–¥–∏–Ω–∞ = –≤–∏—Å–æ–∫–∞ —á–∞—Å—Ç–æ—Ç–∞ –ª—ñ–Ω—ñ–π
        freq_h = H / 15.0 
        r_bg = 0.5 + 0.4 * np.sin(freq_h * t) * np.cos(t)
        ax.plot(t, r_bg, color=selected_cmap(0.1), linewidth=0.5, alpha=0.2)

        # === 2. –¶–ï–ù–¢–†–ê–õ–¨–ù–ï –ö–Ü–õ–¨–¶–ï (–°–û–ù) ===
        # –§—ñ–∫—Å–æ–≤–∞–Ω–∏–π –∑–æ–≤–Ω—ñ—à–Ω—ñ–π —Ä–∞–¥—ñ—É—Å —è–¥—Ä–∞
        R_core = 0.25
        
        # –í–Ω—É—Ç—Ä—ñ—à–Ω—ñ–π —Ä–∞–¥—ñ—É—Å –∑–∞–ª–µ–∂–∏—Ç—å –≤—ñ–¥ —Å–Ω—É. 
        # S_max (12) -> hole = 0 (—Å—É—Ü—ñ–ª—å–Ω–µ). S_min (0) -> hole = R_core (–ø—É—Å—Ç–æ).
        hole_ratio = 1 - (S / 12.0)
        hole_ratio = max(0.0, min(0.95, hole_ratio)) # –û–±–º–µ–∂—É—î–º–æ, —â–æ–± –Ω–µ –∑–Ω–∏–∫–ª–æ –∑–æ–≤—Å—ñ–º
        
        r_hole = R_core * hole_ratio
        
        # –ú–∞–ª—é—î–º–æ –∫—ñ–ª—å—Ü–µ (fill_between –ø—Ä–∞—Ü—é—î –∫—Ä–∞—â–µ –Ω–∞ 0-2pi)
        t_circle = np.linspace(0, 2*np.pi, 500)
        ax.fill_between(t_circle, r_hole, R_core, color=selected_cmap(0.9), alpha=s["f_alpha"] + 0.2)
        ax.plot(t_circle, [R_core]*len(t_circle), color='white', linewidth=s["lw"]*0.5, alpha=0.6)
        
        # === 3. –ü–ï–õ–Æ–°–¢–ö–ò (–ú–Ü–°–Ø–¶–¨ n, –í–ü–ï–í–ù–ï–ù–Ü–°–¢–¨ E) ===
        # –ë–∞–∑—É—é—Ç—å—Å—è –Ω–∞ –∑–æ–≤–Ω—ñ—à–Ω—å–æ–º—É –∫—Ä–∞—ó —è–¥—Ä–∞
        e_val = (12 - E) / 3  # –ö–æ–µ—Ñ—ñ—Ü—ñ—î–Ω—Ç —Ñ–æ—Ä–º–∏
        
        # –†–∞–¥—ñ—É—Å –ø–µ–ª—é—Å—Ç–æ–∫ –º–∞—Å—à—Ç–∞–±—É—î—Ç—å—Å—è —Ç–∞–∫, —â–æ–± –Ω–µ –≤–∏–ª–∞–∑–∏—Ç–∏ –∑–∞ –º–µ–∂—ñ 0.7-0.8
        r_rose = R_core + (np.abs(np.cos(n/2 * t_circle)))**e_val * 0.45
        
        ax.fill(t_circle, r_rose, color=selected_cmap(0.4), alpha=s["f_alpha"])
        ax.plot(t_circle, r_rose, color=selected_cmap(0.5), linewidth=s["lw"], linestyle=s["ls"])
        
        # === 4. –ü–û–õ–ï –°–ü–Ü–†–ê–õ–ï–ô (–í–Ü–ö A) ===
        # –ê—Ä—Ö—ñ–º–µ–¥–æ–≤—ñ —Å–ø—ñ—Ä–∞–ª—ñ
        max_r_rose = r_rose.max()
        
        # –©–æ–± —Å–ø—ñ—Ä–∞–ª—ñ –Ω–µ –≤–∏—Ö–æ–¥–∏–ª–∏ –∑–∞ –º–µ–∂—ñ –∫–∞–¥—Ä—É (max 1.0), –Ω–æ—Ä–º—É—î–º–æ –∫—Ä–æ–∫
        spiral_limit = 1.05
        
        for i in range(1, A + 1, 1): # –ö—Ä–æ–∫ 1, –º–∞–ª—é—î–º–æ –≤—Å—ñ —Ä–æ–∫–∏ –∞–±–æ –ø—Ä–æ—Ä—ñ–¥–∂—É—î–º–æ —è–∫—â–æ —Ç—Ä–µ–±–∞
            if A > 50 and i % 2 == 0: continue # –û–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—è –¥–ª—è –≤–µ–ª–∏–∫–æ–≥–æ –≤—ñ–∫—É
                
            progress = i / A
            
            # –ü–æ–≤–æ—Ä–æ—Ç –∑–∞–ª–µ–∂–∏—Ç—å –≤—ñ–¥ –ï–Ω–µ—Ä–≥—ñ—ó —Ç–∞ –°—Ç–∞—Ç—ñ
            rot_angle = G * i * (T / 10) * (np.pi / 4)
            
            # –°–∞–º–∞ —Å–ø—ñ—Ä–∞–ª—å
            theta_spiral = np.linspace(0, 2*np.pi, 100)
            # –õ—ñ–Ω—ñ–π–Ω–∞ –∑–∞–ª–µ–∂–Ω—ñ—Å—Ç—å —Ä–∞–¥—ñ—É—Å–∞ –≤—ñ–¥ –∫—É—Ç–∞ (–ê—Ä—Ö—ñ–º–µ–¥–æ–≤–∞ —Å–ø—ñ—Ä–∞–ª—å)
            # r –ø–æ—á–∏–Ω–∞—î—Ç—å—Å—è –≤—ñ–¥ –ø–µ–ª—é—Å—Ç–æ–∫ —ñ –π–¥–µ –¥–æ –º–µ–∂—ñ
            r_spiral_line = max_r_rose + (theta_spiral / (2*np.pi)) * (spiral_limit - max_r_rose) * progress
            
            # –î–æ–¥–∞—î–º–æ —Ö–≤–∏–ª—è—Å—Ç—ñ—Å—Ç—å –≤—ñ–¥ –¥–Ω—è –Ω–∞—Ä–æ–¥–∂–µ–Ω–Ω—è
            wave = 0.02 * np.sin(d * theta_spiral)
            
            ax.plot(theta_spiral + rot_angle, r_spiral_line + wave, 
                    color=selected_cmap(progress), 
                    linewidth=s["lw"]*0.3, alpha=s["alpha"]*0.4)

        # === 5. –ó–û–í–ù–Ü–®–ù–Ø –ú–ï–ñ–ê (–ö–û–†–û–ù–ê) ===
        # –ó–∞–≤–∂–¥–∏ –≤ —Ä–∞–π–æ–Ω—ñ 1.0 - 1.1
        p_val = 0.4 if G == 1 else 1.5
        crown_mod = (np.abs(np.sin(d * t_circle)))**p_val
        r_border = 1.0 + 0.1 * crown_mod
        
        ax.plot(t_circle, r_border, color=selected_cmap(0.8), linewidth=s["lw"], alpha=0.9)
        
        # --- –§–Ü–ö–°–ê–¶–Ü–Ø –ö–ê–ú–ï–†–ò ---
        # –¢–µ–ø–µ—Ä –º–∞—Å—à—Ç–∞–± –∑–∞–≤–∂–¥–∏ –æ–¥–Ω–∞–∫–æ–≤–∏–π
        ax.set_ylim(0, 1.2)
        ax.set_axis_off()
        
        return fig

    # –í—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è
    col1, col2, col3 = st.columns([1, 2, 1]) 

    with col2:
        fig = generate_mandala()
        st.pyplot(fig)
        
        # –ö–Ω–æ–ø–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è
        buf = io.BytesIO()
        fig.savefig(buf, format="png", facecolor='black', dpi=300)
        st.download_button(label="üì• –ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –º–∞–Ω–¥–∞–ª—É (PNG)", data=buf.getvalue(), 
                           file_name=f"mandala.png", mime="image/png")
